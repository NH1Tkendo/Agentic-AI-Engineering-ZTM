## Ghi chú học tập: Ngày 2 - Các Mẫu Thiết Kế Luồng Công Việc trong Hệ Thống Tác Tử

### Mục tiêu bài học
- Khám phá sâu hơn về luồng công việc (workflows) trong hệ thống tác tử (agentic systems).
- Hiểu năm mẫu thiết kế (design patterns) theo Anthropic để xây dựng hệ thống có luồng công việc.
- Nhận diện sự mờ nhạt giữa luồng công việc và tác tử (agents), với yếu tố tự chủ (autonomy) có thể xuất hiện.

### Nội dung chính

#### 1. Giới thiệu về các mẫu thiết kế luồng công việc
- Anthropic xác định năm mẫu thiết kế phổ biến trong hệ thống tác tử sử dụng luồng công việc.
- Trong sơ đồ: 
  - Hộp vàng đại diện cho lời gọi mô hình ngôn ngữ lớn (LLM calls).
  - Hộp xanh đại diện cho mã code tùy chọn (code).
- Các mẫu này phân tích nhiệm vụ thành các bước cố định, nhưng có thể có yếu tố tự chủ, làm mờ ranh giới với tác tử.

#### 2. Mẫu 1: Xâu chuỗi lời nhắc (Prompt Chaining)
![](/md_assets/prompt-chaining.png)
- **Mô tả**: 
  - Nhiệm vụ đầu vào được xử lý qua chuỗi lời gọi LLM liên tiếp.
  - Kết quả từ LLM trước được truyền sang LLM sau, có thể qua mã code trung gian.
- **Ví dụ**: 
  - Giống bài tập ngày 1: LLM đầu tiên chọn lĩnh vực kinh doanh (business sector), LLM thứ hai xác định điểm đau (pain point), LLM thứ ba đề xuất giải pháp.
- **Lợi ích**: 
  - Phân tích nhiệm vụ thành các subtasks cố định.
  - Tối ưu hóa từng lời nhắc (prompt) để tăng hiệu quả và giữ quy trình trong giới hạn (guardrails).
- **Lưu ý**: Có thể có tự chủ nếu LLM đầu tiên quyết định nội dung cho các bước sau, làm mờ ranh giới với tác tử.

#### 3. Mẫu 2: Định tuyến (Routing)
![](/md_assets/Routing.png)
- **Mô tả**: 
  - LLM đầu tiên (router) phân loại nhiệm vụ và chọn LLM chuyên biệt (specialist models) phù hợp từ nhiều lựa chọn.
- **Lợi ích**: 
  - Tách biệt trách nhiệm (separation of concerns), tận dụng chuyên môn của từng LLM.
  - LLM router quyết định dựa trên phân loại nhiệm vụ.
- **Lưu ý**: Có yếu tố tự chủ ở router, nhưng vẫn theo luồng công việc cố định, không hoàn toàn linh hoạt.

#### 4. Mẫu 3: Song song hóa (Parallelization)
![](/md_assets/Parralelization.png)
- **Mô tả**: 
  - Mã code (không phải LLM) phân tích nhiệm vụ thành nhiều phần và chạy song song qua các LLM.
  - Kết quả được tổng hợp bởi mã code khác (aggregator).
- **Ví dụ**: 
  - Có thể chạy cùng nhiệm vụ nhiều lần và lấy trung bình, hoặc xử lý các subtasks khác nhau đồng thời.
- **Lợi ích**: 
  - Tăng tốc độ bằng cách thực hiện đồng thời.
- **So sánh**: Giống định tuyến nhưng sử dụng code thay vì LLM để phối hợp.

#### 5. Mẫu 4: Người phối hợp - Người thực hiện (Orchestrator Worker)
![](/md_assets/Orchestrator-worker.png)
- **Mô tả**: 
  - LLM phối hợp (orchestrator) phân tích nhiệm vụ phức tạp thành các bước nhỏ, giao cho các LLM thực hiện (workers).
  - LLM phối hợp tổng hợp kết quả cuối cùng.
- **Lợi ích**: 
  - Linh hoạt hơn, LLM phối hợp có quyền quyết định cách phân chia nhiệm vụ (số lượng workers, cách thức).
- **So sánh**: Giống song song hóa nhưng sử dụng LLM thay vì code để phối hợp, tăng tính động (dynamic).
- **Lưu ý**: Có tự chủ cao hơn, gần với mẫu tác tử hơn là luồng công việc cố định.

#### 6. Mẫu 5: Người đánh giá - Tối ưu hóa (Evaluator Optimizer)
![](/md_assets/Evaluator-optimizer.png)
- **Mô tả**: 
  - LLM tạo (generator) thực hiện nhiệm vụ và đề xuất giải pháp.
  - LLM đánh giá (evaluator) kiểm tra kết quả, chấp nhận hoặc từ chối với lý do.
  - Nếu từ chối, phản hồi quay lại LLM tạo để cải thiện, tạo vòng lặp phản hồi (feedback loop).
- **Lợi ích**: 
  - Tăng độ chính xác, dự đoán và độ tin cậy (robustness) của hệ thống sản xuất.
  - LLM đánh giá tập trung vào kiểm tra, không tạo nội dung, với thông tin bổ sung để đánh giá tốt hơn.
- **Ứng dụng**: 
  - Thường gọi là người đánh giá (evaluators) hoặc người xác thực (validation agents).
  - Rất phổ biến để đảm bảo chất lượng đầu ra trong các giải pháp LLM thực tế.

### Ghi chú thêm
- **Ranh giới mờ nhạt**: Các mẫu luồng công việc có thể có tự chủ (autonomy), làm chúng gần với tác tử hơn Anthropic phân loại.
- **Liên kết chéo**: Kết nối với ghi chú về *Hệ Thống Tác Tử (Agentic Systems)* và *Tính Tự Chủ của LLM (LLM Autonomy)* trong Obsidian để hiểu sâu hơn về sự khác biệt.
- **Ứng dụng thực tế**: Áp dụng các mẫu này vào công việc hàng ngày để xây dựng hệ thống LLM đáng tin cậy hơn.

---

*Ghi chú được tối ưu hóa cho Obsidian, với cấu trúc logic và dễ tra cứu.*